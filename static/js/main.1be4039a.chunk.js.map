{"version":3,"sources":["cell.js","dialog.js","settingDialog.js","game.js","logManager.js","dataAnalysis.js","index.js"],"names":["GamePage","handleClick","props","onDig","data","this","value","digged","marked","classList","status","valueDisplay","className","join","onClick","Component","Dialog","container","visible","document","body","removeChild","createElement","add","modalClass","appendChild","customClass","push","ReactDOM","render","children","limitValue","min","max","SettingDialog","state","display","width","height","mines","errorMsg","resolve","reject","handleInputChange","e","target","test","Number","name","MAX_WIDTH","setState","setLevel","level","startGame","errorList","length","maxMines","cancelSubmit","param","Promise","Object","assign","autoComplete","maxLength","onInput","VALUE_MINE","board","operation","$refs","settingDialog","createRef","openSetting","a","current","open","localStorage","setItem","JSON","stringify","console","error","row","array","col","key","Math","random","handleDig","map","cell","initMines","dig","autoproc","gameFinished","forEach","counter","time","Date","getTime","success","storageData","storageDataRaw","getItem","parse","Array","isArray","item","id","uuid","writeLog","openDataAnalysis","window","location","pathname","rows","cols","row0","col0","result","count","getNeighbours","mineCount","y","x","RangeError","cellList","i","j","floor","temp","iCell","splice","getNeighbourMineCount","further","neighbours","filter","mark","markCount","settingData","remainMines","ref","DataAnalysis","dataRaw","dataList","exportJSON","saveAs","Blob","type","exportDBF","dbfData","ID","WIDTH","HEIGHT","MINES","SUCCESS","START","TIME","toFixed","dbf","structure","buffer","goBack","readLog","listLow","listMid","listHigh","label","getStatResult","success_times","one_click_finish","total_steps","time_total","success_rate","average_steps","average_time","StrictMode","path","exact","component","to","from","getElementById"],"mappings":"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","file":"static/js/main.1be4039a.chunk.js","sourcesContent":["import {Component} from 'react';\r\n\r\nconst VALUE_MINE=9;\r\nexport default class GamePage extends Component{\r\n    handleClick=()=>{\r\n        this.props.onDig(this.props.data);\r\n    }\r\n    render(){\r\n        let data=this.props.data, value=data.value&0x0f;\r\n        let digged=data.value&0x80, marked=data.value&0x40;\r\n        let classList=[\r\n            'cell',\r\n            digged ? 'digged' : '',\r\n            VALUE_MINE===value ? 'mine' : '',\r\n            marked ? 'marked' : '',\r\n            'failed'===this.props.status || 'success'===this.props.status ? 'inactive' : ''\r\n        ];\r\n        let valueDisplay='';\r\n        if(marked){\r\n            valueDisplay='★';\r\n        }else if(digged){\r\n            switch(value){\r\n                case VALUE_MINE:\r\n                    valueDisplay='雷';\r\n                break;\r\n                case 0:\r\n                    valueDisplay='';\r\n                break;\r\n                default:\r\n                    valueDisplay=value;\r\n                break;\r\n            }\r\n        }else if('failed'===this.props.status && VALUE_MINE===value){\r\n            valueDisplay='雷';\r\n        }\r\n        return (\r\n            <div className={classList.join(' ')} onClick={this.handleClick}>\r\n                {valueDisplay}\r\n            </div>\r\n        );\r\n    }\r\n}\r\n","import {Component} from 'react';\r\nimport ReactDOM from 'react-dom';\r\n\r\nexport default class Dialog extends Component{\r\n  container=null;\r\n  constructor(){\r\n    super();\r\n  }\r\n  componentDidUpdate(){\r\n    let visible=this.props.visible;\r\n    //切换body上的容器的新建和销毁\r\n    if(!visible && this.container){\r\n      let body = document.body;\r\n      body.removeChild(this.container);\r\n      this.container=null;\r\n    }else if(visible && !this.container){\r\n      let body = document.body;\r\n      let container = document.createElement(\"div\");\r\n      container.classList.add('dialog-container');\r\n      if(this.props.modalClass){\r\n        container.classList.add(this.props.modalClass);\r\n      }\r\n      this.container=container;\r\n      body.appendChild(container);\r\n    }\r\n    //更新对话框里的内容\r\n    if(!visible){\r\n      return;\r\n    }\r\n    let classList=[\r\n      'dialog-body'\r\n    ];\r\n    if(this.props.customClass){\r\n      classList.push(this.props.customClass);\r\n    }\r\n    ReactDOM.render(\r\n      <div className={classList.join(' ')}>{this.props.children}</div>,\r\n      this.container\r\n    );\r\n  }\r\n  render(){\r\n    return null;\r\n  }\r\n}","import {Component} from 'react';\r\nimport Dialog from './dialog';\r\n\r\nconst MIN_WIDTH=4;\r\nconst MAX_WIDTH=30;\r\nconst MIN_HEIGHT=4;\r\nconst MAX_HEIGHT=24;\r\n\r\nfunction limitValue(value,min,max){\r\n  if(value<min){\r\n    return min;\r\n  }else if (value>max){\r\n    return max;\r\n  }\r\n  return value;\r\n}\r\nexport default class SettingDialog extends Component{\r\n  state={\r\n    display:false,\r\n    width:30,\r\n    height:16,\r\n    mines:99,\r\n    errorMsg:null\r\n  }\r\n  resolve=null;\r\n  reject=null;\r\n  constructor(){\r\n    super();\r\n  }\r\n  open(param){\r\n    return new Promise((resolve,reject)=>{\r\n      Object.assign(this,{\r\n        resolve,\r\n        reject\r\n      });\r\n      this.setState({\r\n        ...param,\r\n        display:true\r\n      });\r\n    })\r\n  }\r\n  handleInputChange=(e)=>{\r\n    const target = e.target;\r\n    let value=target.value;\r\n    if(/^\\d+$/.test(value)){\r\n      value=Number(value);\r\n      switch(target.name){\r\n        case 'width':\r\n          value=limitValue(value,MIN_WIDTH,MAX_WIDTH);\r\n        break;\r\n        case 'height':\r\n          value=limitValue(value,MIN_HEIGHT,MAX_HEIGHT);\r\n        break;\r\n        case 'mines':\r\n          value=limitValue(value,4,MAX_WIDTH*MAX_HEIGHT-1);\r\n        break;\r\n      }\r\n    }\r\n    this.setState({\r\n      [target.name]: value\r\n    });\r\n  }\r\n  setLevel=(level)=>{\r\n    switch(level){\r\n      case 'beginner':\r\n        this.setState({\r\n          width:10,\r\n          height:10,\r\n          mines:10\r\n        });\r\n      break;\r\n      case 'medium':\r\n        this.setState({\r\n          width:16,\r\n          height:16,\r\n          mines:40\r\n        });\r\n      break;\r\n      case 'expert':\r\n        this.setState({\r\n          width:30,\r\n          height:16,\r\n          mines:99\r\n        });\r\n      break;\r\n    }\r\n    this.setState({\r\n      errorMsg:null\r\n    });\r\n  }\r\n  startGame=()=>{\r\n    let {width,height,mines}=this.state;\r\n    let errorList=[];\r\n    if(!/^\\d+$/.test(width)){\r\n      errorList.push('宽度值必须为整数');\r\n    }\r\n    if(!/^\\d+$/.test(height)){\r\n      errorList.push('高度值必须为整数');\r\n    }\r\n    if(!/^\\d+$/.test(mines)){\r\n      errorList.push('雷数必须为整数');\r\n    }\r\n    if(errorList.length){\r\n      this.setState({\r\n        errorMsg:errorList.join('\\n')\r\n      });\r\n      return;\r\n    }\r\n    width=Number(width);\r\n    height=Number(height);\r\n    mines=Number(mines);\r\n    let maxMines=width*height-1;\r\n    if(mines>maxMines){\r\n      mines=maxMines;\r\n    }\r\n    \r\n    if(this.resolve){\r\n      this.resolve({\r\n        width,\r\n        height,\r\n        mines\r\n      });\r\n    }\r\n    this.resolve=this.reject=null;\r\n    this.setState({\r\n      width,\r\n      height,\r\n      mines,\r\n      display:false\r\n    });\r\n  }\r\n  cancelSubmit=()=>{\r\n    if(this.reject){\r\n      this.reject('cancel');\r\n    }\r\n    this.resolve=this.reject=null;\r\n    this.setState({\r\n      display:false\r\n    });\r\n  }\r\n  render(){\r\n    let errorMsg=this.state.errorMsg;\r\n    return (\r\n      <Dialog visible={this.state.display} customClass='settingDialog'>\r\n        <div className='levelSelection'>\r\n          <span className='selectLevel' onClick={e=>this.setLevel('beginner')}>初级</span>\r\n          <span className='selectLevel' onClick={e=>this.setLevel('medium')}>中级</span>\r\n          <span className='selectLevel' onClick={e=>this.setLevel('expert')}>高级</span>\r\n        </div>\r\n        <div className='gameSettingForm'>\r\n          <div className='formItem'>\r\n            <span className='itemTitle'>宽度({MIN_WIDTH}-{MAX_WIDTH})</span>\r\n            <input name='width' autoComplete=\"off\" maxLength='2' value={this.state.width} onInput={this.handleInputChange}/>\r\n          </div>\r\n          <div className='formItem'>\r\n            <span className='itemTitle'>高度({MIN_HEIGHT}-{MAX_HEIGHT})</span>\r\n            <input name='height' autoComplete=\"off\" maxLength='2' value={this.state.height} onInput={this.handleInputChange}/>\r\n          </div>\r\n          <div className='formItem'>\r\n            <span className='itemTitle'>雷数(2-{MAX_WIDTH*MAX_HEIGHT-1})</span>\r\n            <input name='mines' autoComplete=\"off\" maxLength='3' value={this.state.mines} onInput={this.handleInputChange}/>\r\n          </div>\r\n        </div>\r\n        {errorMsg && <div className='errorMsg'>{errorMsg}</div>}\r\n        <button className='startGame' onClick={this.startGame}><span>确定</span></button>\r\n        <button className='cancelSetting' onClick={this.cancelSubmit}><span>取消</span></button>\r\n      </Dialog>\r\n    );\r\n  }\r\n}\r\n","import {Component, createRef} from 'react';\r\nimport Cell from './cell';\r\nimport {writeLog} from './logManager';\r\nimport SettingDialog from './settingDialog.js';\r\n\r\nexport const VALUE_MINE=9;\r\nexport default class GamePage extends Component{\r\n  state={\r\n    width:null,\r\n    height:null,\r\n    mines:null,\r\n    board:[],\r\n    operation:[],\r\n    status:'initial'\r\n  };\r\n  $refs={\r\n    settingDialog:createRef()\r\n  }\r\n  constructor(){\r\n      super();\r\n  }\r\n  openSetting=async()=>{\r\n    try{\r\n      let data = await this.$refs.settingDialog.current.open({\r\n        width:this.state.width,\r\n        height:this.state.height,\r\n        mines:this.state.mines\r\n      });\r\n      await this.setState(data);\r\n      this.startGame();\r\n      localStorage.setItem('react-minesweeper-settings',JSON.stringify(data));\r\n    }catch(e){\r\n      if('cancel'!==e){\r\n        console.error(e);\r\n      }\r\n    }\r\n  }\r\n  startGame=()=>{\r\n    let board=[], width=this.state.width, height=this.state.height;\r\n    for(let row=0;row<height;row++){\r\n        let array=[];\r\n        for(let col=0;col<width;col++){\r\n            array.push({\r\n                key:Math.random(),\r\n                row,\r\n                col,\r\n                value:0\r\n            });\r\n        }\r\n        board.push({\r\n            key:Math.random(),\r\n            data:array\r\n        });\r\n    }\r\n    this.setState({\r\n      board,\r\n      operation:[],\r\n      status:'initial'\r\n    });\r\n  }\r\n  getNeighbours(rows,cols,row0,col0){\r\n    let result=[];\r\n    for(let row=row0-1; row<=row0+1; row++){\r\n      for(let col=col0-1; col<=col0+1; col++){\r\n        if(row<0 || row>=rows || col<0 || col>=cols || (row===row0 && col===col0)){\r\n          continue;\r\n        }\r\n        result.push({\r\n          row,col\r\n        });\r\n      }\r\n    }\r\n    return result;\r\n  }\r\n  getNeighbourMineCount(target,row0,col0){\r\n      let rows=target.length, cols=target[0].data.length, count=0,row,col;\r\n      for({row,col} of this.getNeighbours(rows,cols,row0,col0)){\r\n          let cell=target[row].data[col];\r\n          if(VALUE_MINE===(cell.value&0xf)){\r\n              count++;\r\n          }\r\n      }\r\n      return count;\r\n  }\r\n  initMines(target,mineCount,y,x){\r\n      let rows=target.length, cols=target[0].data.length;\r\n      if(mineCount >= rows*cols){\r\n        throw new RangeError('Too many mines');\r\n      }\r\n\r\n      let cellList=[];\r\n      for(let row=0; row<rows; row++){\r\n        for(let col=0; col<cols; col++){\r\n          //跳过被点击的位置\r\n          if(y===row && x===col){\r\n            continue;\r\n          }\r\n\r\n          cellList.push({\r\n            row,col\r\n          });\r\n        }\r\n      }\r\n\r\n      //对坐标列表进行洗牌\r\n      let length=cellList.length;\r\n      for(let i=0; i<length; i++){\r\n        if(Math.random()>0.5){\r\n          continue;\r\n        }\r\n        let j=Math.floor(Math.random()*(length-i-1))+i+1;\r\n        if(cellList[j]){\r\n          let temp=cellList[i];\r\n          cellList[i]=cellList[j];\r\n          cellList[j]=temp;\r\n        }\r\n      }\r\n\r\n      //布雷\r\n      for(let i=0; i<mineCount && cellList.length; i++){\r\n        let iCell=Math.floor(Math.random()*(cellList.length-1));\r\n        try{\r\n          let {row,col}=cellList[iCell];\r\n          target[row].data[col].value=VALUE_MINE;\r\n          cellList.splice(iCell,1);\r\n        }catch(e){\r\n          console.error(iCell,cellList.length,cellList[iCell]);\r\n        }\r\n      }\r\n\r\n      //标上数字\r\n      for(let row=0; row<rows; row++){\r\n        for(let col=0; col<cols; col++){\r\n          let cell=target[row].data[col];\r\n          if(VALUE_MINE===cell.value){\r\n              continue;\r\n          }\r\n          cell.value=this.getNeighbourMineCount(target,row,col);\r\n        }\r\n      }\r\n  }\r\n  dig(target,row0,col0){\r\n      let cell=target[row0].data[col0], counter=cell.value&0x0f;\r\n\r\n      //不可挖开的方块\r\n      if(cell.value&0xc0){\r\n        return 0;\r\n      }\r\n\r\n      //挖开该方块\r\n      target[row0].data[col0].value |= 0x80;\r\n\r\n      //挖到雷\r\n      if(VALUE_MINE===counter){\r\n        return -1;\r\n      }\r\n\r\n      return 1;\r\n  }\r\n  mark(target,row,col){\r\n      target[row].data[col].value |= 0x40;\r\n  }\r\n  autoproc(target){\r\n    let rows=target.length, cols=target[0].data.length;\r\n    let further=false;\r\n\r\n    //找到空方块，然后挖开周围方块；找到周边未挖开块数等于当前块雷数的块，然后把周围块标上\r\n    for(let row=0; row<rows; row++){\r\n      for(let col=0; col<cols; col++){\r\n        let cell=target[row].data[col], counter=cell.value&0x0f;\r\n        if(VALUE_MINE===counter || !(0xC0 & cell.value)){\r\n          continue;\r\n        }\r\n        let neighbours=this.getNeighbours(rows,cols,row,col).filter(({row,col})=>{\r\n            let cell=target[row].data[col];\r\n            return !(0x80&cell.value);\r\n        });\r\n        if(0===counter){\r\n          neighbours.forEach(({row,col})=>{\r\n              if(this.dig(target,row,col)){\r\n                  further=true;\r\n              }\r\n          });\r\n        }else if(neighbours.length === counter){\r\n          neighbours.forEach(({row,col})=>{\r\n              this.mark(target,row,col);\r\n          });\r\n        }\r\n      }\r\n    }\r\n\r\n    //找到周边被标记块数等于当前块雷数的块，然后把周围未标记且未挖开的块挖开\r\n    for(let row=0; row<rows; row++){\r\n      for(let col=0; col<cols; col++){\r\n        let cell=target[row].data[col], counter=cell.value&0x0f;\r\n        if(VALUE_MINE===counter || !(0xC0 & cell.value) || 0===counter){\r\n          continue;\r\n        }\r\n\r\n        //当前块周围被标记的块的个数\r\n        let neighbours=this.getNeighbours(rows,cols,row,col), markCount=0;\r\n        neighbours.forEach(({row,col})=>{\r\n          let cell=target[row].data[col];\r\n          if(0x40&cell.value){\r\n            markCount++;\r\n          }\r\n        });\r\n\r\n        //当前块周围被标记的块的个数不等于当前块的雷数\r\n        if(counter!==markCount){\r\n          continue;\r\n        }\r\n\r\n        //当前块周围未挖开且未标记的块挖开\r\n        neighbours.forEach(({row,col})=>{\r\n          let cell=target[row].data[col];\r\n          if(!(0xC0&cell.value)){\r\n            further=true;\r\n            this.dig(target,row,col);\r\n          }\r\n        });\r\n\r\n        //挖到雷了\r\n        if('failed'===this.status){\r\n          return false;\r\n        }\r\n      }\r\n    }\r\n\r\n    return further;\r\n  }\r\n  gameFinished(target){\r\n    let rows=target.length, cols=target[0].data.length;\r\n    for(let row=0; row<rows; row++){\r\n      for(let col=0; col<cols; col++){\r\n        let cell=target[row].data[col], counter=cell.value&0x0f;\r\n        if(VALUE_MINE!==counter && !(0x80&cell.value)){\r\n            return false;\r\n        }\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n  handleDig=(data)=>{\r\n    let state=this.state;\r\n    let board=state.board.map(row=>({\r\n        ...row,\r\n        data:row.data.map(cell=>({\r\n            ...cell\r\n        }))\r\n    })), status=state.status;\r\n    //游戏结束了\r\n    if('failed'===status || 'success'===status){\r\n        return;\r\n    }\r\n\r\n    //刚开始挖时布雷\r\n    if('initial'===status){\r\n        this.initMines(board,state.mines,data.row,data.col);\r\n        status='running';\r\n    }\r\n\r\n    //挖开方块\r\n    let ret = this.dig(board,data.row,data.col);\r\n    if(-1===ret){\r\n        status='failed';\r\n    }\r\n\r\n    //处理更多雷\r\n    while('running'===status && this.autoproc(board)){}\r\n\r\n    //当前局面是否完成\r\n    if('running'===status && this.gameFinished(board)){\r\n      //完成时把没标上的地雷标上\r\n      for(let row of board){\r\n        row.data.forEach((cell,col)=>{\r\n          let counter=cell.value&0x0f;\r\n          if(VALUE_MINE===counter){\r\n            row.data[col].value|=0x40;\r\n          }\r\n        });\r\n      }\r\n      status='success';\r\n    }\r\n\r\n    //新加一步\r\n    let operation=[ //记录操作\r\n      ...state.operation,\r\n      {\r\n        time:new Date().getTime(),\r\n        col:data.col,\r\n        row:data.row\r\n      }\r\n    ];\r\n\r\n    //成功或失败时记录当前局面\r\n    if('failed'===status || 'success'===status){\r\n      writeLog(board,operation,'success'===status);\r\n    }\r\n    \r\n    this.setState({\r\n      ...state,\r\n      operation,\r\n      status,\r\n      board\r\n    });\r\n  }\r\n  async componentDidMount() {\r\n    //从localStorage获取设置，没获取到就用默认值\r\n    await this.setState({\r\n      width:30,\r\n      height:16,\r\n      mines:99\r\n    });\r\n    try{\r\n      let settingData=localStorage.getItem('react-minesweeper-settings');\r\n      if(settingData){\r\n        settingData=JSON.parse(settingData);\r\n        await this.setState({\r\n          width:Number(settingData.width),\r\n          height:Number(settingData.height),\r\n          mines:Number(settingData.mines)\r\n        });\r\n      }\r\n    }catch(e){\r\n      console.error(e);\r\n    }\r\n    this.startGame();\r\n  }\r\n  openDataAnalysis=()=>{\r\n    window.location=window.location.pathname+'#/dataAnalysis';\r\n  }\r\n  render(){\r\n    let status=this.state.status;\r\n    let remainMines=this.state.mines;\r\n    for(let row of this.state.board){\r\n      for(let cell of row.data){\r\n        if(0x40&cell.value){\r\n          remainMines--;\r\n        }\r\n      }\r\n    }\r\n    return (\r\n      <div className=\"gamePage\">\r\n        <div className=\"titleBar\">\r\n          <span className='newGame btn-link' onClick={this.startGame}>新游戏</span>\r\n          <span className='back btn-link' onClick={this.openSetting}>设置</span>\r\n          <span className='newGame btn-link' onClick={this.openDataAnalysis}>数据分析</span>\r\n          <span className='steps'>步数：{this.state.operation.length}</span>\r\n          <span className='remainMines'>剩余雷数：{remainMines}</span>\r\n          {\r\n            'success'===status\r\n            ? <span className='statusLine success'>成功了</span>\r\n            : 'failed'===status\r\n            ? <span className='statusLine failed'>失败了</span>\r\n            : <span className='statusLine'></span>\r\n          }\r\n        </div>\r\n        <div className='gamePadOuter'>\r\n          <div className='gamePad'>\r\n            {\r\n              this.state.board.map(row=><div className='gamePadRow' key={row.key}>\r\n                {\r\n                  row.data.map(cell=><Cell data={cell} key={cell.key} onDig={this.handleDig} status={this.state.status}></Cell>)\r\n                }\r\n              </div>)\r\n            }\r\n          </div>\r\n        </div>\r\n        <SettingDialog ref={this.$refs.settingDialog}>awdfaw</SettingDialog>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import {v4 as uuid} from 'uuid';\r\nimport {VALUE_MINE} from './game.js';\r\n\r\nexport function writeLog(board,operation,success=false){\r\n    let width=board[0].data.length, height=board.length, mines=[];\r\n    for(let row=0; row<height; row++){\r\n        for(let col=0; col<width; col++){\r\n            let value=board[row].data[col].value;\r\n            if(VALUE_MINE===(value&0x0f)){\r\n                mines.push({col,row});\r\n            }\r\n        }\r\n    }\r\n\r\n    let storageData=[];\r\n    try{\r\n        let storageDataRaw=localStorage.getItem('react-minesweeper-log');\r\n        if(storageDataRaw){\r\n            storageData=JSON.parse(storageDataRaw);\r\n        }\r\n    }catch(e){\r\n        console.error(e);\r\n    }\r\n    if(!Array.isArray(storageData)){\r\n        storageData=[];\r\n    }\r\n    for(let item of storageData){\r\n        if(!item.id){\r\n            item.id=uuid();\r\n        }\r\n    }\r\n    storageData.push({\r\n        id:uuid(),\r\n        width,\r\n        height,\r\n        success,\r\n        mines,\r\n        operation\r\n    });\r\n    localStorage.setItem('react-minesweeper-log',JSON.stringify(storageData));\r\n}\r\nexport function readLog(){\r\n    let storageData=[];\r\n    try{\r\n        let storageDataRaw=localStorage.getItem('react-minesweeper-log');\r\n        if(storageDataRaw){\r\n            storageData=JSON.parse(storageDataRaw);\r\n        }\r\n    }catch(e){\r\n        console.error(e);\r\n    }\r\n    return storageData;\r\n}\r\n","import {Component} from 'react';\r\nimport {readLog} from './logManager';\r\nimport {saveAs} from 'file-saver';\r\nimport './dataAnalysis.scss';\r\nimport dbf from 'dbf';\r\nexport default class DataAnalysis extends Component{\r\n    state={\r\n        dataRaw:null,\r\n        dataList:[]\r\n    };\r\n    componentWillMount(){\r\n        let dataRaw = readLog();\r\n        let listLow = dataRaw.filter(item=>(10===item.width && 10===item.height && 10===item.mines.length));\r\n        let listMid = dataRaw.filter(item=>(16===item.width && 16===item.height && 40===item.mines.length));\r\n        let listHigh = dataRaw.filter(item=>(\r\n            ((30===item.width && 16===item.height) || (16===item.width && 30===item.height))\r\n            && 99===item.mines.length));\r\n        this.setState({\r\n            dataRaw,\r\n            dataList:[\r\n                {\r\n                    label:'初级',\r\n                    ...this.getStatResult(listLow)\r\n                },\r\n                {\r\n                    label:'中级',\r\n                    ...this.getStatResult(listMid)\r\n                },\r\n                {\r\n                    label:'高级',\r\n                    ...this.getStatResult(listHigh)\r\n                }\r\n            ]\r\n        });\r\n    }\r\n    getStatResult(data){\r\n        let success_times=0, one_click_finish=0, total_steps=0, time_total=0;\r\n        for(let item of data){\r\n            if(item.success){\r\n                success_times++;\r\n            }\r\n            if(1===item.operation.length){\r\n                one_click_finish++;\r\n            }\r\n            total_steps+=item.operation.length;\r\n            let time=item.operation[item.operation.length-1].time-item.operation[0].time;\r\n            time_total+=time;\r\n        }\r\n        return{\r\n            success_rate: data.length ? success_times/data.length : 0,\r\n            one_click_finish,\r\n            average_steps: data.length ? total_steps/data.length : 0,\r\n            average_time: data.length ? time_total/data.length : 0,\r\n        }\r\n    }\r\n    exportJSON=()=>{\r\n        saveAs(new Blob([JSON.stringify(this.state.dataRaw)], {type: \"text/plain;charset=utf-8\"}),'minesweeper-log.json');\r\n    }\r\n    exportDBF=()=>{\r\n        let dbfData=[];\r\n        for(let item of this.state.dataRaw){\r\n            dbfData.push({\r\n                ID:item.id,\r\n                WIDTH:item.width,\r\n                HEIGHT:item.height,\r\n                MINES:item.mines.length,\r\n                SUCCESS:item.success ? 'Y' : 'N',\r\n                START:item.operation[0].time,\r\n                TIME:((item.operation[item.operation.length-1].time-item.operation[0].time)/1000).toFixed(2)\r\n            });\r\n        }\r\n        saveAs(new Blob([dbf.structure(dbfData).buffer]),'mine.dbf');\r\n    }\r\n    goBack=()=>{\r\n        window.location=window.location.pathname+'#/';\r\n    }\r\n    render(){\r\n        return <div className='dataAnalysis'>\r\n            <div className='toolbox'>\r\n                <span className='btn-link' onClick={this.goBack}>返回</span>\r\n                <span className='btn-link' onClick={this.exportJSON}>导出JSON数据</span>\r\n                <span className='btn-link' onClick={this.exportDBF}>导出DBF数据</span>\r\n            </div>\r\n            <table className='mainTable'>\r\n                <tbody>\r\n                    <tr>\r\n                        <th>级别</th>\r\n                        <th>成功率</th>\r\n                        <th>平均步数</th>\r\n                        <th>平均用时</th>\r\n                        <th>一次成功次数</th>\r\n                    </tr>\r\n                    {\r\n                        this.state.dataList.map(item=>{\r\n                            return <tr key={item.label}>\r\n                                <td>{item.label}</td>\r\n                                <td>{(item.success_rate*100).toFixed(2)}%</td>\r\n                                <td>{(item.average_steps).toFixed(2)}步</td>\r\n                                <td>{(item.average_time/1000).toFixed(2)}s</td>\r\n                                <td>{item.one_click_finish}</td>\r\n                            </tr>\r\n                        })\r\n                    }\r\n                </tbody>\r\n            </table>\r\n        </div>\r\n    }\r\n}","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './style.scss';\nimport GamePage from './game';\nimport DataAnalysis from './dataAnalysis';\nimport { HashRouter, Route, Redirect } from 'react-router-dom';\n//import reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <HashRouter>\n      <Route path=\"/\" exact component={GamePage}></Route>\n      <Route path=\"/dataAnalysis\" exact component={DataAnalysis}></Route>\n      <Redirect to=\"/\" from='*'/>\n    </HashRouter>\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\n//reportWebVitals();\n"],"sourceRoot":""}